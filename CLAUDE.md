# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## 言語設定

**重要**: このプロジェクトでは日本語を主言語として使用します。
- コミットメッセージ：日本語で記述
- コード内のコメント：日本語で記述
- ドキュメント：日本語で記述
- Claude Codeとのやりとり：日本語で実施

## プロジェクト概要

**gitlab_repo_analyzer** - GitLabリポジトリを分析するNode.jsベースのツール（現在初期セットアップ段階）

## 開発環境

- **ランタイム**: Node.js 22
- **開発環境**: VS Code Dev Containers
- **パッケージマネージャー**: npm

## コマンド

### 開発
```bash
# 依存関係のインストール
npm install

# アプリケーションの実行（index.js作成後）
node index.js

# テストの実行（テストフレームワーク設定後）
npm test
```

## アーキテクチャ

このプロジェクトは初期セットアップ段階です。実装時の指針：

1. **エントリーポイント**: `index.js`をメインエントリーポイントとして作成（package.jsonで参照済み）
2. **GitLab統合**: GitLab APIを使用してリポジトリ分析を実装
3. **分析機能**: 以下の実装を検討：
   - リポジトリ構造分析
   - コード品質メトリクス
   - 依存関係分析
   - セキュリティ脆弱性スキャン
   - コミット履歴分析

## 開発ガイドライン

1. **プロジェクト構造**: コードを論理的なモジュールに整理：
   - `/src` - メインソースコード
   - `/lib` - 再利用可能なユーティリティ
   - `/test` - テストファイル
   - `/config` - 設定ファイル

2. **エラーハンドリング**: API障害やエッジケースに対する堅牢なエラーハンドリングを実装

3. **設定**: GitLab APIトークンと設定には環境変数を使用

4. **テスト**: 機能追加前にテストフレームワーク（JestまたはMocha）をセットアップ

5. **リンティング**: コードの一貫性のためESLint設定を追加

## 開発ワークフロー

### Claude Code 使用時の権限設定

Claude Codeで開発作業を行う際は、必要最小限の権限を設定します：

```bash
# セキュリティを考慮した最小権限設定
claude --allowedTools "Bash(git:*),Bash(gh:*),Bash(npm:*),Bash(node:*),Bash(mkdir:*),Bash(rm:*)"
```

### PR作成ルール

**重要**: 全ての修正作業はPull Requestを通して行います。

1. **ブランチ作成**: `claude/issue-{number}-{date}` 形式でブランチを作成
2. **コミット前チェック**: 以下のコマンドを順次実行し、全て成功することを確認
   ```bash
   npm install
   npm run typecheck  # 型チェック（設定後）
   npm run lint       # リンター実行（設定後）
   npm test           # テスト実行（設定後）
   ```
3. **コミットメッセージ**: 日本語で記述、変更内容を簡潔に説明
4. **PRタイトル**: 日本語で記述、イシュー番号を含める（例：「#28 開発環境権限設定とプロジェクトルール策定」）

### 権限エラー対応手順

Claude Codeで権限エラーが発生した場合の対応：

1. **エラー原因の特定**: 
   - エラーメッセージを確認し、具体的なコマンドを特定
   - 必要最小限の権限のみを特定

2. **権限設定の更新**:
   - `--allowedTools` パラメータに必要なコマンドのみ追加
   - セキュリティを考慮し、過度に広範な権限は避ける

3. **文書化**:
   - 新たに必要となった権限はこのファイルに追記
   - 権限エラーの発生原因と解決策を記録

4. **イシュー作成**:
   - 権限エラーが再発する場合は専用イシューを作成
   - エラーの発生したコマンドと解決策を明記

### 開発コマンド実行順序

標準的な開発作業の流れ：

1. **依存関係インストール**: `npm install`
2. **型チェック**: `npm run typecheck`（設定後）
3. **リンター実行**: `npm run lint`（設定後）
4. **テスト実行**: `npm test`（設定後）
5. **Git操作**: 
   ```bash
   git add .
   git commit -m "変更内容の説明"
   git push origin ブランチ名
   ```

## 次のステップ

プロジェクト開発時：
1. 基本的なプロジェクト構造を作成
2. GitLab API認証をセットアップ
3. コア分析機能を実装
4. 適切なエラーハンドリングとロギングを追加
5. 包括的なテストを作成
6. ドキュメントを追加