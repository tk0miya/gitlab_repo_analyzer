# PR作成コマンド

このコマンドは新しいブランチを作成し、品質チェックを実行してからプルリクエストを作成します。

## 実行される処理

1. **変更内容の確認**
   - 現在の変更ファイルと差分を確認
   - 変更内容に基づいて適切なブランチ名を決定

2. **新しいブランチの作成**
   - 変更内容に基づいた適切なブランチ名を生成
   - メインブランチから新しいブランチを作成

3. **品質チェックの実行**
   - Biomeでのlint・format
   - TypeScript型チェック
   - Vitestでのテスト実行

4. **コミットの作成**
   - 変更内容をステージング
   - 差分内容を要約したコミットメッセージを生成
   - コミットを作成

5. **プルリクエストの作成**
   - ブランチをリモートにプッシュ
   - GitHub CLIでプルリクエストを作成

## 使用例

```bash
/pr-create
```

## 前提条件

- Git リポジトリが初期化されていること
- GitHub CLI (gh) がインストール・認証済みであること
- npm プロジェクトであること (package.json が存在)
- リモートリポジトリが設定されていること

## エラーハンドリング

- 品質チェックが失敗した場合、処理を中断します
- テストが失敗した場合、処理を中断します
- 変更がない場合、空のコミットは作成しません

---

# 実行処理

## ステップ1: 変更内容確認
まず変更内容を確認して、適切なブランチ名を決定します。

```bash
# 変更されたファイルを確認
git status
git diff

# 変更内容を分析してブランチ名を決定
# 例: 新機能追加 -> feature/機能名
#     バグ修正 -> fix/修正内容
#     リファクタリング -> refactor/対象
```

## ステップ2: ブランチ作成
変更内容に基づいて適切な名前のブランチを作成します。

```bash
# 変更内容に基づいたブランチ名を生成
BRANCH_NAME="$(変更内容に基づくブランチ名)"

# メインブランチから新しいブランチを作成・切り替え
git checkout main
git pull origin main
git checkout -b $BRANCH_NAME
```

## ステップ3: 品質チェック
コード品質を確保するため、以下のチェックを実行します。

```bash
# 依存関係が最新であることを確認
npm install

# Biomeでlint・format実行
npm run lint
npm run format

# TypeScript型チェック
npm run typecheck

# テスト実行
npm test
```

品質チェックのいずれかが失敗した場合、処理を中断してエラーメッセージを表示します。

## ステップ4: コミット作成
変更内容をステージングしてコミットを作成します。

```bash
# 変更内容をステージング
git add .

# 実際の差分を確認
git diff --cached

# 差分内容を要約してコミットメッセージを生成
# レビューコメントや作業過程は除外し、実際の変更内容のみを記述
git commit -m "$(差分内容を要約したメッセージ)

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>"
```

## ステップ5: プルリクエスト作成
ブランチをプッシュしてプルリクエストを作成します。

```bash
# ブランチをリモートにプッシュ
git push -u origin $BRANCH_NAME

# GitHub CLIでプルリクエストを作成
gh pr create --title "$(コミットメッセージのタイトル行)" --body "$(cat <<'EOF'
## 概要
$(変更内容の要約)

## テスト
- [ ] ローカルでの動作確認
- [ ] 品質チェック通過
- [ ] テスト通過

🤖 Generated with [Claude Code](https://claude.ai/code)
EOF
)"
```

## 最終出力
プルリクエストのURLを表示して完了します。

```bash
echo "プルリクエストが作成されました:"
gh pr view --web
```